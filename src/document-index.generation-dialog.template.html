<!DOCTYPE html>
<html>
    <head>
        <base target="_top">
        <style>
            fieldset {
                margin-top: 1em;
                margin-bottom: 1em;
            }
            #generate {
                float: right;
            }
        </style>
        <script>
            window.addEventListener("load", function() {
                generate.addEventListener("click", function() {
                    const enableGenerateButton = function() {
                        generate.disabled = ""
                        generate.value = "Generate"
                    }
                    const disableGenerateButton = function() {
                        generate.disabled = "disabled"
                        generate.value = "Generating..."
                    }
                    const onSuccess = function() {
                        google.script.host.close()
                    }
                    const onFailure = function(e) {
                        alert("ERROR: " + e)
                        enableGenerateButton()
                    }
                    const options = {
                        rootFolderUrl: rootFolderUrl.value,
                        maxDepth: maxDepth.value,
                        outputSheetName: outputSheetName.value,
                        pathSeparator: pathSeparator.value,
                        includeFiles: includeFiles.checked,
                        includeFolders: includeFolders.checked,
                    }
                    disableGenerateButton()
                    google.script.run.withSuccessHandler(onSuccess)
                                     .withFailureHandler(onFailure)
                                     .DocumentIndex_onGenerateButtonClicked(options)
                })
            })
        </script>
    </head>
    <body>
        <fieldset>
            <legend>Traverse options</legend>
            <div>
                <label for="rootFolderUrl">Root folder URL: </label>
                <input id="rootFolderUrl" type="text" value="<?= rootFolderUrl ?>" />
            </div>
            <div>
                <label for="maxDepth">Max depth:</label>
                <input id="maxDepth" type="text" value="<?= maxDepth ?>" />
            </div>
        </fieldset>
        <fieldset>
            <legend>Output options</legend>
            <div>
                <label for="outputSheetName">Output sheet name: </label>
                <input id="outputSheetName" type="text" value="<?= outputSheetName ?>" />
            </div>
            <div>
                <label for="pathSeparator">Path separator: </label>
                <input id="pathSeparator" type="text" value="<?= pathSeparator ?>" />
            </div>
            <div>
                <? if (includeFiles) { ?>
                    <input id="includeFiles" type="checkbox" checked="checked" />
                <? } else { ?>
                    <input id="includeFiles" type="checkbox" />
                <? } ?>
                <label for="includeFiles">Include files</label>
            </div>
            <div>
                <? if (includeFolders) { ?>
                    <input id="includeFolders" type="checkbox" checked="checked" />
                <? } else { ?>
                    <input id="includeFolders" type="checkbox" />
                <? } ?>
                <label for="includeFolders">Include folders</label>
            </div>
        </fieldset>
        <div>
            <input id="generate" type="button" value="Generate" />
        </div>
    </body>
</html>

